{"version":3,"sources":["src/preprocessAst/extractAcyclicRelation.js"],"names":[],"mappings":";;;;;;;;;;qBASS,sBAAsB;;gCATZ,oBAAoB;;;;AASvC,SAAS,sBAAsB,CAAC,YAA2B,EAAE,YAA4B,EAAE,aAA6B,EAAE,mBAA8B,EAAiB;AACrK,QAAI,WAAW,GAAG,EAAE,CAAC;AACrB,QAAI,UAAU,GAAG,SAAb,UAAU,CAAG,aAAa;eAAK,OAAO,aAAa,KAAK,UAAU,GAAG,aAAa,GAAI,UAAC,CAAC;mBAAK,CAAC,CAAC,aAAa,CAAC;SAAA,AAAC;KAAC,CAAC;AACpH,QAAI,UAAU,GAAG,UAAU,CAAC,YAAY,CAAC;QACrC,WAAW,GAAG,UAAU,CAAC,aAAa,CAAC,CAAC;AAC5C,gBAAY,CAAC,OAAO,CAAC,UAAA,GAAG,EAAI;AACxB,YAAI,EAAE,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC;AACzB,YAAI,GAAG,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC;;AAE3B,YAAI,EAAE,EAAE,IAAI,WAAW,CAAA,AAAC,EACpB,WAAW,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC;AACzB,YAAI,GAAG,EAAE;AACL,gBAAI,EAAE,GAAG,IAAI,WAAW,CAAA,AAAC,EACrB,WAAW,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC;AAC1B,uBAAW,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SAC7B;KACJ,CAAC,CAAC;AACH,QAAI,SAAS,GAAG,8BAAO,UAAU,CAAC,WAAW,CAAC,CAAC;AAC/C,QAAI,SAAS,CAAC,OAAO,EACjB,MAAM,IAAI,KAAK,CAAC,yBAAsB,mBAAmB,GAAI,MAAM,GAAG,mBAAmB,GAAI,EAAE,CAAA,0BAAuB,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;;AAE3J,WAAO;AACH,aAAK,EAAE,WAAW;AAClB,aAAK,EAAE,SAAS,CAAC,QAAQ;KAC5B,CAAC;CACL","file":"src/preprocessAst/extractAcyclicRelation.js","sourcesContent":["import depres from 'depres/dist/depres';\r\n\r\ntype StringSelector = string | ((x: any) => string);\r\n\r\nexport\r\ndefault\r\n\r\nfunction extractAcyclicRelation(relationList: Array < any >, idOrSelector: StringSelector, depOrSelector: StringSelector, relationDescription ? : string): Rx.Observable {\r\n    var relationMap = {};\r\n    var selectorOf = keyOrSelector => (typeof keyOrSelector === 'function' ? keyOrSelector : ((x) => x[keyOrSelector]));\r\n    var idSelector = selectorOf(idOrSelector),\r\n        depSelector = selectorOf(depOrSelector);\r\n    relationList.forEach(rel => {\r\n        var id = idSelector(rel);\r\n        var dep = depSelector(rel);\r\n\r\n        if (!(id in relationMap))\r\n            relationMap[id] = [];\r\n        if (dep) {\r\n            if (!(dep in relationMap))\r\n                relationMap[dep] = [];\r\n            relationMap[id].push(dep);\r\n        }\r\n    });\r\n    var depResult = depres.resolveMap(relationMap);\r\n    if (depResult.aborted)\r\n        throw new Error(`Circular dependency${relationDescription ? (' in ' + relationDescription) : ''}; Did not resolve ` + depResult.unresolved.join(', '));\r\n\r\n    return {\r\n        edges: relationMap,\r\n        order: depResult.resolved\r\n    };\r\n}"]}