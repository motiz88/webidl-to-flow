{"version":3,"sources":["src/cli/actions/processIdlFiles.js"],"names":[],"mappings":";;;;;;;;;;;qBAiBS,eAAe;;kBAhBT,IAAI;;;;kBACJ,IAAI;;;;sBACA,SAAS;;;;8BACD,sBAAsB;;;;+BACrB,uBAAuB;;;;sBAEhC,eAAe;;;;sBACf,QAAQ;;;;uBACP,SAAS;;;;mBACb,KAAK;;;;AAOrB,SAAS,eAAe,CAAC,MAAwB,EAAS;AACtD,oBAAG,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CACrB,SAAS,CAAC,UAAA,KAAK,EAAI;AAChB,YAAI,KAAK,KAAK,GAAG,EACb,OAAO,gBAAG,UAAU,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,KACtC;AACD,gBAAI,QAAQ,GAAG,iBAAI,KAAK,CAAC,KAAK,CAAC,CAAC;AAChC,gBAAI,QAAQ,CAAC,QAAQ,KAAK,OAAO,IAAI,QAAQ,CAAC,QAAQ,KAAK,QAAQ,EAAE;AACjE,oBAAI,GAAG,GAAG,IAAI,oBAAO,WAAW,EAAE,CAAC;AACnC,0CAAQ,KAAK,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACzB,uBAAO,gBAAG,UAAU,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;aAChC;SACJ;AACD,eAAO,CAAC,oBAAO,QAAQ,CAAC,KAAK,CAAC,GAAG,yBAAO,KAAK,CAAC,GAAG,gBAAG,UAAU,CAAC,EAAE,CAAC,KAAK,CAAC,CAAA,CACnE,GAAG,CAAC,gBAAG,gBAAgB,CAAC,CAAC;KACjC,CAAC,CACD,SAAS,CAAC,UAAA,QAAQ,EAAI;AACnB,gBAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;AAC7B,eAAO,oBAAO,kBAAkB,CAAC,QAAQ,CAAC,CACrC,OAAO,EAAE,CAAC,GAAG,CAAC,UAAA,GAAG;mBAAI,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC;SAAA,CAAC,CAAC;KAC3C,CAAC,CACD,SAAS,6BAAgB,CACzB,SAAS,8BAAiB,CAC1B,OAAO,CAAC,UAAA,CAAC;eAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;KAAA,EAAE,UAAA,GAAG;eAAI,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,IAAI,GAAG,CAAC;KAAA,EAAE;eAAM,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;KAAA,CAAC,CAAC;CAC1H","file":"src/cli/actions/processIdlFiles.js","sourcesContent":["/* @flow */\r\nimport fs from 'fs';\r\nimport Rx from 'rx';\r\nimport RxNode from 'rx-node';\r\nimport parseIdlSource from '../../parseIdlSource';\r\nimport translateIdlAst from '../../translateIdlAst';\r\n\r\nimport rxGlob from '../../rx-glob';\r\nimport stream from 'stream';\r\nimport request from 'request';\r\nimport url from 'url';\r\n\r\nexport\r\ndefault\r\n\r\nfunction processIdlFiles(inputs: Array < string > ): void {\r\n    Rx.Observable.from(inputs)\r\n        .concatMap(input => {\r\n            if (input === '-')\r\n                return Rx.Observable.of(process.stdin);\r\n            else {\r\n                var inputUrl = url.parse(input);\r\n                if (inputUrl.protocol === 'http:' || inputUrl.protocol === 'https:') {\r\n                    var buf = new stream.PassThrough();\r\n                    request(input).pipe(buf);\r\n                    return Rx.Observable.of(buf);\r\n                }\r\n            }\r\n            return (rxGlob.hasMagic(input) ? rxGlob(input) : Rx.Observable.of(input))\r\n                .map(fs.createReadStream);\r\n        })\r\n        .concatMap(readable => {\r\n            readable.setEncoding('utf8');\r\n            return RxNode.fromReadableStream(readable)\r\n                .toArray().map(arr => arr.join(\"\"));\r\n        })\r\n        .concatMap(parseIdlSource)\r\n        .concatMap(translateIdlAst)\r\n        .forEach(s => process.stdout.write(s), err => console.error(err.stack || err), () => process.stdout.write('\\n\\n'));\r\n}"]}